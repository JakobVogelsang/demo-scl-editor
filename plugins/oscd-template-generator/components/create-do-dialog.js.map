{"version":3,"file":"create-do-dialog.js","sourceRoot":"","sources":["../../components/create-do-dialog.ts"],"names":[],"mappings":"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","sourcesContent":["/* eslint-disable @typescript-eslint/no-unused-vars */\nimport { ScopedElementsMixin } from '@open-wc/scoped-elements/lit-element.js';\nimport { LitElement, html, css } from 'lit';\nimport { property, query, state } from 'lit/decorators.js';\nimport { Tree, TreeNode } from '@openenergytools/tree-grid';\nimport { MdSelectOption } from '@scopedelement/material-web/select/MdSelectOption.js';\nimport { MdFilledSelect } from '@scopedelement/material-web/select/MdOutlineSelect.js';\nimport { MdOutlinedTextField } from '@scopedelement/material-web/textfield/MdOutlinedTextField.js';\nimport { MdDialog } from '@scopedelement/material-web/dialog/dialog.js';\nimport { MdTextButton } from '@scopedelement/material-web/button/text-button.js';\nimport { debounce } from '../utils/debounce.js';\n\n// eslint-disable-next-line no-shadow\nenum DONameStatus {\n  Ok = 'Ok',\n  Taken = 'Taken',\n  InvalidCDC = 'InvalidCDC',\n  CustomNamespaceNeeded = 'CustomNamespaceNeeded',\n}\n\nconst firstTextBlockRegExp = /[A-Za-z]+/;\n\nexport class CreateDataObjectDialog extends ScopedElementsMixin(LitElement) {\n  static scopedElements = {\n    'md-dialog': MdDialog,\n    'md-text-button': MdTextButton,\n    'md-outlined-select': MdFilledSelect,\n    'md-select-option': MdSelectOption,\n    'md-outlined-text-field': MdOutlinedTextField,\n  };\n\n  @property({ type: Array })\n  cdClasses: string[] = [];\n\n  @property()\n  tree: Partial<Record<string, TreeNode>> = {};\n\n  @property({ type: Function })\n  onConfirm?: (\n    cdcType: string,\n    doName: string,\n    namespace: string | null\n  ) => void;\n\n  @query('md-dialog')\n  dialog!: MdDialog;\n\n  @query('#cdc-type')\n  cdcType!: MdFilledSelect;\n\n  @query('#do-name')\n  doName!: MdOutlinedTextField;\n\n  @query('#namespace')\n  namespace!: MdOutlinedTextField;\n\n  private namespaceDefaultValue = 'User-Defined';\n\n  @state()\n  private isCustomNamespaceDisabled = true;\n\n  get open() {\n    return this.dialog?.open ?? false;\n  }\n\n  show() {\n    this.dialog?.show();\n  }\n\n  close() {\n    if (this.cdcType) {\n      this.cdcType.errorText = '';\n      this.cdcType.error = false;\n      this.cdcType.reset();\n    }\n\n    if (this.doName) {\n      this.doName.errorText = '';\n      this.doName.error = false;\n      this.doName.value = '';\n    }\n    this.dialog?.close();\n  }\n\n  private getDONameStatus(): DONameStatus {\n    const doNameValue = this.doName.value;\n    const cdcValue = this.cdcType.value;\n    const isTaken = doNameValue in this.tree;\n\n    if (isTaken) {\n      return DONameStatus.Taken;\n    }\n\n    const multiTree = Object.keys(this.tree)\n      .filter(key => (this.tree[key] as any).presCond === 'Omulti')\n      .reduce((acc, key) => {\n        acc[key] = this.tree[key];\n        return acc;\n      }, {} as any);\n\n    const firstTextBlockMatch = doNameValue.match(firstTextBlockRegExp);\n\n    if (firstTextBlockMatch) {\n      const firstTextBlock = firstTextBlockMatch[0];\n      const matchingTreeNode = multiTree[`${firstTextBlock}1`];\n\n      if (matchingTreeNode) {\n        const doCDCsMatch = cdcValue === matchingTreeNode.type;\n\n        if (!doCDCsMatch) {\n          return DONameStatus.InvalidCDC;\n        }\n\n        return DONameStatus.Ok;\n      }\n    }\n\n    return DONameStatus.CustomNamespaceNeeded;\n  }\n\n  private onValueChange = debounce(() => {\n    if (!this.cdcType.value || !this.doName.value) {\n      this.isCustomNamespaceDisabled = true;\n      return;\n    }\n\n    const status = this.getDONameStatus();\n    this.setDONameStatusError(status);\n\n    this.isCustomNamespaceDisabled =\n      status !== DONameStatus.CustomNamespaceNeeded;\n  }, 300);\n\n  private setDONameStatusError(status: DONameStatus): void {\n    if (status === DONameStatus.Taken) {\n      this.doName.errorText = 'DO name already in use';\n      this.doName.error = true;\n    } else {\n      this.doName.errorText = '';\n      this.doName.error = false;\n    }\n\n    if (status === DONameStatus.InvalidCDC) {\n      this.cdcType.errorText = 'CDC type invalid for this DO';\n      this.cdcType.error = true;\n    } else {\n      this.cdcType.errorText = '';\n      this.cdcType.error = false;\n    }\n  }\n\n  private validate(): boolean {\n    let isValid = true;\n\n    if (!this.cdcType?.value) {\n      this.cdcType.errorText = 'Please select a common data class.';\n      this.cdcType.error = true;\n      isValid = false;\n    } else {\n      this.cdcType.errorText = '';\n      this.cdcType.error = false;\n    }\n\n    if (!this.doName?.checkValidity()) {\n      this.doName.errorText = 'Not a valid DO name.';\n      this.doName.error = true;\n      isValid = false;\n    } else {\n      this.doName.errorText = '';\n      this.doName.error = false;\n    }\n\n    const status = this.getDONameStatus();\n\n    if (status === DONameStatus.CustomNamespaceNeeded) {\n      if (!this.namespace.value) {\n        this.namespace.errorText = 'Custom namespace required.';\n        this.namespace.error = true;\n        isValid = false;\n      }\n    } else if (\n      status === DONameStatus.Taken ||\n      status === DONameStatus.InvalidCDC\n    ) {\n      this.setDONameStatusError(status);\n      isValid = false;\n    }\n\n    return isValid;\n  }\n\n  /* eslint-disable class-methods-use-this */\n  private resetErrorText(e: Event): void {\n    const target = e.target as MdOutlinedTextField | MdFilledSelect;\n    if (target.errorText && target.checkValidity()) {\n      target.errorText = '';\n      target.error = false;\n    }\n  }\n\n  private handleConfirm() {\n    if (!this.validate()) return;\n\n    const status = this.getDONameStatus();\n\n    const namespace =\n      status === DONameStatus.CustomNamespaceNeeded\n        ? this.namespace.value\n        : null;\n    this.onConfirm?.(this.cdcType?.value, this.doName?.value, namespace);\n    this.close();\n  }\n\n  render() {\n    return html`\n      <md-dialog @closed=${() => this.close()}>\n        <div slot=\"headline\">Add Data Object</div>\n        <div slot=\"content\" class=\"dialog-content\">\n          <md-outlined-select\n            id=\"cdc-type\"\n            class=\"cdc-type\"\n            label=\"Common Data Class\"\n            required\n            @input=${(e: Event) => {\n              this.resetErrorText(e);\n              this.onValueChange();\n            }}\n          >\n            ${this.cdClasses.map(\n              cdClass =>\n                html`<md-select-option value=${cdClass}\n                  >${cdClass}</md-select-option\n                >`\n            )}\n          </md-outlined-select>\n          <md-outlined-text-field\n            id=\"do-name\"\n            label=\"Data Object Name\"\n            required\n            maxlength=\"12\"\n            pattern=\"[A-Z][0-9A-Za-z]*\"\n            @input=${(e: Event) => {\n              this.resetErrorText(e);\n              this.onValueChange();\n            }}\n          ></md-outlined-text-field>\n          <md-outlined-text-field\n            id=\"namespace\"\n            label=\"Namespace\"\n            placeholder=${this.namespaceDefaultValue}\n            required\n            .disabled=${this.isCustomNamespaceDisabled}\n            @input=${this.resetErrorText}\n          ></md-outlined-text-field>\n        </div>\n        <div slot=\"actions\">\n          <md-text-button id=\"cancel-btn\" @click=${this.close} type=\"button\"\n            >Cancel</md-text-button\n          >\n          <md-text-button\n            id=\"confirm-btn\"\n            @click=${this.handleConfirm}\n            type=\"button\"\n            >Add</md-text-button\n          >\n        </div>\n      </md-dialog>\n    `;\n  }\n\n  static styles = css`\n    md-text-button {\n      text-transform: uppercase;\n    }\n    .dialog-content {\n      display: flex;\n      flex-direction: column;\n      gap: 12px;\n    }\n  `;\n}\n"]}